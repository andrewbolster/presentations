import{d as D,I as H,r as _,L as B,H as N,G as I,f as p,n as v,g as S,t as A,o as h,p as $}from"../modules/vue-D6AE_F9i.js";import{C as P}from"../index-aSTIun2T.js";const T=["innerHTML"],K=["textContent"],R=["textContent"],g="slidev-note-fade",f="slidev-note-click-mark",z=D({__name:"NoteDisplay",props:{class:{},noteHtml:{},note:{},highlight:{type:Boolean,default:!0},placeholder:{},clicksContext:{},autoScroll:{type:Boolean}},emits:["markerDblclick","markerClick"],setup(r,{emit:E}){const n=r,C=E,x=H(()=>{var i;return n.clicksContext!=null&&((i=n.noteHtml)==null?void 0:i.includes("slidev-note-click-mark"))}),m=_(null);function y(){var M,b;if(!m.value||!x.value)return;const i=Array.from(m.value.querySelectorAll(`.${f}`)),c=new Map,a=new Map;let w=0;for(const s of i){const o=Number(s.dataset.clicks);c.set(s,o);let t=s,e=s.parentElement;for(;e&&t!==m.value;)a.has(e)||a.set(e,[[null,w]]),a.get(e).push([t,o]),t=e,e=e.parentElement;w=o}const L=new Map;for(const[s,o]of a){let t=!1,e=0;for(const l of Array.from(s.childNodes)){let d=!1;for(;l===((M=o[e+1])==null?void 0:M[0]);)d=!0,e++;if(d)continue;let k=l;if(l.nodeType===3){if(!((b=l.textContent)!=null&&b.trim()))continue;k=document.createElement("span"),k.textContent=l.textContent,s.insertBefore(k,l),l.remove()}t||(t=e===0),L.set(k,o[e][1])}t||(o[0][1]=-1)}return s=>{const o=n.highlight;for(const[t,e]of a)t.classList.toggle(g,o&&!e.some(([l,d])=>d===s));for(const[t,e]of L)t.classList.toggle(g,o&&e!==s);for(const[t,e]of c)t.classList.remove(g),t.classList.toggle(`${f}-past`,o&&e<s),t.classList.toggle(`${f}-active`,o&&e===s),t.classList.toggle(`${f}-next`,o&&e===s+1),t.classList.toggle(`${f}-future`,o&&e>s+1),t.ondblclick=o?l=>{C("markerDblclick",l,e),!l.defaultPrevented&&(n.clicksContext.current=e,l.stopPropagation(),l.stopImmediatePropagation())}:null,t.onclick=o?l=>{C("markerClick",l,e)}:null,o&&n.autoScroll&&e===s&&t.scrollIntoView({block:"center",behavior:"smooth"})}}const u=_();return B(()=>[n.noteHtml,n.highlight],()=>{$(()=>{u.value=y()})},{immediate:!0}),N(()=>{y()}),I(()=>{var c,a;const i=((c=n.clicksContext)==null?void 0:c.current)??P;(a=u.value)==null||a.call(u,i)}),(i,c)=>r.noteHtml?(h(),p("div",{key:0,ref_key:"noteDisplay",ref:m,class:v(["prose overflow-auto outline-none slidev-note",[n.class,x.value?"slidev-note-with-clicks":""]]),innerHTML:r.noteHtml},null,10,T)):r.note?(h(),p("div",{key:1,class:v(["prose overflow-auto outline-none slidev-note",n.class])},[S("p",{textContent:A(r.note)},null,8,K)],2)):(h(),p("div",{key:2,class:v(["prose overflow-auto outline-none opacity-50 italic select-none slidev-note",n.class])},[S("p",{textContent:A(n.placeholder||"No notes.")},null,8,R)],2))}});export{z as _};
